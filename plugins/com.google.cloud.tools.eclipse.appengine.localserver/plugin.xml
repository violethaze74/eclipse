<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.4"?>
<!-- I think all or most classes come from 
  http://git.eclipse.org/c/servertools/webtools.servertools.git/ -->
<plugin>
   <extension point="org.eclipse.wst.server.core.runtimeTypes">
      <runtimeType
            class="org.eclipse.jst.server.generic.core.internal.GenericServerRuntime"
            description="GCloud based App Engine runtime"
            id="com.google.cloud.tools.eclipse.gcloud.runtime"
            name="App Engine"
            vendor="Google"
            vendorId="google"
            version="0.1.0">
         <moduleType
               types="jst.web"
               versions="2.5">
         </moduleType>
      </runtimeType>
   </extension>
   
   <extension point="org.eclipse.wst.server.core.serverTypes">
      <serverType
            hasConfiguration="false"
            behaviourClass="org.eclipse.jst.server.generic.core.internal.ExternalServerBehaviour"
            class="org.eclipse.jst.server.generic.core.internal.GenericServer"
            description="App Engine server that delegates to gcloud"
            id="com.google.cloud.tools.eclipse.gcloud.server"
            initialState="stopped"
            launchModes="run,debug"
            launchConfigId="org.eclipse.jst.server.generic.core.ExternalLaunchConfigurationType"
            name="GCloud based App Engine Server"
            runtime="true"
            runtimeTypeId="com.google.cloud.tools.eclipse.gcloud.runtime"
            startBeforePublish="true"
            startTimeout="120000"
            stopTimeout="15000">
      </serverType>
   </extension>
   
   <extension point="org.eclipse.jst.server.core.runtimeClasspathProviders">
      <runtimeClasspathProvider
            class="org.eclipse.jst.server.generic.core.internal.GenericServerRuntimeTargetHandler"
            id="com.google.cloud.tools.eclipse.gcloud.runtimeClasspathProvider"
            runtimeTypeIds="com.google.cloud.tools.eclipse.gcloud.*" />
   </extension>
   
   <extension point="org.eclipse.wst.common.project.facet.core.runtimes">
      <runtime-component-type id="com.google.cloud.tools.eclipse.gcloud" />
      <runtime-component-version
            type="com.google.cloud.tools.eclipse.gcloud"
            version="0.1.0" />
      <supported>
         <facet id="jst.web" version="[2.2-2.5]" />
         <runtime-component id="com.google.cloud.tools.eclipse.gcloud" version="0.1.0"/>
      </supported>
      
      <adapter>
         <runtime-component id="com.google.cloud.tools.eclipse.gcloud" />
         <factory class="org.eclipse.jst.server.core.internal.RuntimeClasspathProvider$Factory" />
         <type class="org.eclipse.jst.common.project.facet.core.IClasspathProvider" />
      </adapter>
      <adapter>
         <runtime-component id="com.google.cloud.tools.eclipse.gcloud" />
         <factory class="org.eclipse.jst.server.ui.internal.RuntimeLabelProvider$Factory" />
         <type class="org.eclipse.wst.common.project.facet.ui.IRuntimeComponentLabelProvider" />
      </adapter>
   </extension>
   
   <extension point="org.eclipse.jst.server.core.runtimeFacetMappings">
      <runtimeFacetMapping
            runtime-component="com.google.cloud.tools.eclipse.gcloud"
            runtimeTypeId="com.google.cloud.tools.eclipse.gcloud.runtime"
            version="0.1.0" />
   </extension>
   
   <extension point="org.eclipse.wst.server.ui.wizardFragments">
      <fragment
            class="org.eclipse.jst.server.generic.ui.internal.GenericServerRuntimeWizardFragment"
            id="org.eclipse.jst.server.generic.runtime"
            typeIds="com.google.cloud.tools.eclipse.gcloud.runtime" />
      <fragment
            class="org.eclipse.jst.server.generic.ui.internal.GenericServerWizardFragment"
            id="org.eclipse.jst.server.generic.server"
            typeIds="com.google.cloud.tools.eclipse.gcloud.server" />
   </extension>
   
   <extension point="org.eclipse.wst.server.ui.serverImages">
      <image
            id="com.google.cloud.tools.eclipse.gcloud.serverImage"
            icon="icons/gcp-16x16.png"
            typeIds="com.google.cloud.tools.eclipse.gcloud.server,com.google.cloud.tools.eclipse.gcloud.runtime">
      </image>
   </extension>
   
   <extension point="org.eclipse.jst.server.generic.core.serverdefinition">
      <!-- WTP brain damage: id attribute here is an idref, not an id -->
      <serverdefinition
            definitionfile="gcloud_serverdef.xml"
            id="com.google.cloud.tools.eclipse.gcloud.runtime">
      </serverdefinition>
   </extension>
   
   
   
   <extension
         point="org.eclipse.wst.server.core.runtimeTypes">
      <runtimeType
            class="com.google.cloud.tools.eclipse.appengine.localserver.runtime.CloudSdkRuntime"
            description="%runtimeTypeDescription"
            id="com.google.cloud.tools.eclipse.runtime.id1"
            name="%runtimeTypeName"
            vendor="%runtimeTypeVendor"
            version="1">
            <moduleType types="jst.web" versions="2.2, 2.3, 2.4, 2.5"/>
            <moduleType types="jst.connector" versions="1.0, 1.5, 1.6"/>
            <moduleType types="jst.utility"  versions="1.0"/>
      </runtimeType>
   </extension>
   <extension
         point="org.eclipse.wst.server.ui.wizardFragments">
      <fragment
            class="com.google.cloud.tools.eclipse.appengine.localserver.ui.CloudSdkRuntimeWizardFragment"
            id="com.google.cloud.tools.eclipse.runtime.fragment1"
            typeIds="com.google.cloud.tools.eclipse.runtime.id1">
      </fragment>
   </extension>
   <extension point="org.eclipse.wst.common.project.facet.core.facets">
      <project-facet id="com.google.cloud.tools.eclipse.facet">
        <label>%cloudsdkfacetlabel</label>
        <description>%cloudsdkfacetdescription</description>
      </project-facet>
      <project-facet-version facet="com.google.cloud.tools.eclipse.facet" version="1">
          <constraint>
            <and>
               <requires
                     facet="jst.web"
                     version="[2.2-2.5]">
               </requires>
              <requires facet="java" version="[1.4-1.7]"/>
           </and>
         </constraint>
      </project-facet-version>
      <action
          facet="com.google.cloud.tools.eclipse.facet"
          id="com.google.cloud.tools.eclipse.facet.install"
          type="install">
        <delegate class="com.google.cloud.tools.eclipse.appengine.localserver.facet.CloudSdkFacetInstallDelegate"/>
      </action>
      <action
          facet="com.google.cloud.tools.eclipse.facet"
          id="com.google.cloud.tools.eclipse.facet.uninstall"
          type="uninstall">
        <delegate class="com.google.cloud.tools.eclipse.appengine.localserver.facet.CloudSdkFacetUninstallDelegate"/>
      </action>
   </extension>
   <extension point="org.eclipse.wst.common.project.facet.core.runtimes">
      <runtime-component-type id="com.google.cloud.tools.eclipse.runtime.id"/>
      <runtime-component-version type="com.google.cloud.tools.eclipse.runtime.id" version="1"/>
      <supported>
          <runtime-component id="com.google.cloud.tools.eclipse.runtime.id" version="1"/>
          <facet id="com.google.cloud.tools.eclipse.facet" version="1"/>
          <facet id="jst.web" version="[2.2-2.5]"/>
          <facet id="jst.utility"  version="1.0"/>
          <facet id="jst.webfragment" version="3.0" />
          <facet id="java" version="[1.4-1.7]" />
      </supported>
   </extension>
   <extension point="org.eclipse.jst.server.core.runtimeFacetMappings">
    <runtimeFacetMapping runtimeTypeId="com.google.cloud.tools.eclipse.runtime.id1"
        runtime-component="com.google.cloud.tools.eclipse.runtime.id" version="1"/>
   </extension>
   <extension
         point="org.eclipse.m2e.core.projectConfigurators">
      <configurator
            class="com.google.cloud.tools.eclipse.appengine.localserver.facet.CloudSdkProjectConfigurator"
            id="com.google.cloud.tools.eclipse.maven.cloudSdkConfigurator"
            name="%configurator.name"
            secondaryTo="org.maven.ide.eclipse.configuration.wtp.configurator">
      </configurator>
   </extension>
   <extension
         point="org.eclipse.m2e.core.lifecycleMappingMetadataSource">
   </extension>
   <extension
         point="org.eclipse.wst.server.core.serverTypes">
      <serverType
            behaviourClass="com.google.cloud.tools.eclipse.appengine.localserver.server.CloudSdkServerBehaviour"
            class="com.google.cloud.tools.eclipse.appengine.localserver.server.CloudSdkServer"
            description="%serverTypeDescription"
            id="com.google.cloud.tools.eclipse.server.id"
            initialState="stopped"
            launchConfigId="com.google.cloud.tools.eclipse.CloudSdkLaunchConfigurationType"
            launchModes="run,debug,profile"
            name="%serverTypeName"
            runtime="true"
            runtimeTypeId="com.google.cloud.tools.eclipse.runtime.id1"
            startBeforePublish="false"
            supportsRemoteHosts="false">
      </serverType>
   </extension>
   <extension
         point="org.eclipse.debug.core.launchConfigurationTypes">
      <launchConfigurationType
            delegate="com.google.cloud.tools.eclipse.appengine.localserver.server.CloudSdkLaunchConfigurationDelegate"
            id="com.google.cloud.tools.eclipse.CloudSdkLaunchConfigurationType"
            modes="run, debug, profile"
            name="%serverTypeName">
      </launchConfigurationType>
   </extension>
   <extension
         point="org.eclipse.debug.ui.launchConfigurationTypeImages">
      <launchConfigurationTypeImage
            configTypeID="com.google.cloud.tools.eclipse.CloudSdkLaunchConfigurationType"
            icon="icons/gcp-16x16.png"
            id="com.google.cloud.tools.eclipse.ExternalLaunchConfigurationTypeImage">
      </launchConfigurationTypeImage>
   </extension>
   <extension
         point="org.eclipse.debug.ui.launchConfigurationTabGroups">
      <launchConfigurationTabGroup
            class="com.google.cloud.tools.eclipse.appengine.localserver.ui.CloudSdkLaunchConfigurationTabGroup"
            id="com.google.cloud.tools.eclipse.server.launchConfigurationTabGroup"
            type="com.google.cloud.tools.eclipse.CloudSdkLaunchConfigurationType">
      </launchConfigurationTabGroup>
   </extension>
   <extension
         point="org.eclipse.wst.server.ui.serverImages">
      <image
            icon="icons/gcp-16x16.png"
            id="com.google.cloud.tools.eclipse.image"
            typeIds="com.google.cloud.tools.eclipse.runtime.id1,com.google.cloud.tools.eclipse.server.id">
      </image>
   </extension>
   <extension
         point="org.eclipse.wst.common.project.facet.ui.images">
      <image
            path="icons/gcp-16x16.png"
            facet="com.google.cloud.tools.eclipse.facet">
      </image>
   </extension>
   <extension
         point="org.eclipse.ui.commands">
      <command
            id="com.google.cloud.tools.eclipse.deployCommand"
            name="%cloudsdkdeploy">
      </command>
   </extension>
   <extension
         point="org.eclipse.core.expressions.propertyTesters">
      <propertyTester
            class="com.google.cloud.tools.eclipse.appengine.localserver.deploy.CloudSdkProjectPropertyTester"
            id="com.google.cloud.tools.eclipse.deploy.CloudSdkProjectPropertyTester"
            namespace="com.google.cloud.tools.eclipse"
            properties="isCloudSdkProject"
            type="org.eclipse.core.resources.IProject">
      </propertyTester>
   </extension>
   <extension
         point="org.eclipse.ui.handlers">
      <handler
            class="com.google.cloud.tools.eclipse.appengine.localserver.deploy.CloudSdkDeployProjectHandler"
            commandId="com.google.cloud.tools.eclipse.deployCommand">
         <enabledWhen>
            <with
                  variable="selection">
               <and>
                  <count
                        value="1">
                  </count>
                  <iterate
                        operator="and">
                     <test
                           property="com.google.cloud.tools.eclipse.isCloudSdkProject">
                     </test>
                  </iterate>
               </and>
            </with>
         </enabledWhen>
      </handler>
   </extension>
   <extension
         point="org.eclipse.ui.menus">
      <menuContribution
            allPopups="false"
            locationURI="popup:org.eclipse.ui.popup.any?after=additions">
         <command
               commandId="com.google.cloud.tools.eclipse.deployCommand"
               icon="icons/gcp-16x16.png"
               label="%cloudsdkdeploy">
            <visibleWhen
                  checkEnabled="true">
            </visibleWhen>
         </command>
      </menuContribution>
   </extension>
   <extension
         point="org.eclipse.debug.core.processFactories">
      <processFactory
            class="com.google.cloud.tools.eclipse.appengine.localserver.server.DevAppServerProcessFactory"
            id="com.google.cloud.tools.eclipse.appengine.localserver.processfactory">
      </processFactory>
   </extension>
</plugin>
